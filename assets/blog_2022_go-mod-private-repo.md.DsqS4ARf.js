import{_ as p}from"./chunks/articleMetadata.RSg_oukH.js";import{_ as h,h as r,u as o,B as d,l as n,x as k,ai as c,m as g,f as e,p as b,q as u}from"./chunks/framework.h2at8Qew.js";import"./chunks/theme.DxuMJqyy.js";const D=JSON.parse('{"title":"GoModule添加gitlab私有仓库","description":"本篇记载了如何添加 gitlab 私有仓库到 go mod 中使用，并且可以使用 go get 命令获取到私有仓库的依赖。","frontmatter":{"title":"GoModule添加gitlab私有仓库","description":"本篇记载了如何添加 gitlab 私有仓库到 go mod 中使用，并且可以使用 go get 命令获取到私有仓库的依赖。","date":"2022-04-17T22:38:34.000Z","tags":["Golang"]},"headers":[],"relativePath":"blog/2022/go-mod-private-repo.md","filePath":"posts/blog/2022/go-mod-private-repo/README.md","lastUpdated":1714983786000}'),F={name:"blog/2022/go-mod-private-repo.md"},m=n("h1",{id:"gomodule添加gitlab私有仓库",tabindex:"-1"},[k("GoModule添加gitlab私有仓库 "),n("a",{class:"header-anchor",href:"#gomodule添加gitlab私有仓库","aria-label":'Permalink to "GoModule添加gitlab私有仓库"'},"​")],-1),C=c(`<h2 id="_1-设置env" tabindex="-1">1. 设置env <a class="header-anchor" href="#_1-设置env" aria-label="Permalink to &quot;1. 设置env&quot;">​</a></h2><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置私有仓库的git地址</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> env</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GOPRIVATE=&quot;git@gitlab.xxx.cn&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 允许设置不安全访问，配置后可请求到 http 地址的仓库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> env</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GOINSECURE=&quot;gitlab.xxx.cn&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置请求该地址不需要代理，即GOPROXY</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> env</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GONOPROXY=&quot;gitlab.xxx.cn&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置不验证sum包的签名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> env</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GONOSUMDB=&quot;gitlab.xxx.cn&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="_2-配置秘钥" tabindex="-1">2. 配置秘钥 <a class="header-anchor" href="#_2-配置秘钥" aria-label="Permalink to &quot;2. 配置秘钥&quot;">​</a></h2><p>如果要拉取的库是私有的，需要配置秘钥，可以使用以下命令：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 创建私有仓库的秘钥 （该步骤省略，每个平台不一样）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 设置秘钥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --global</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http.extraheader</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;PRIVATE-TOKEN:上面配置的秘钥&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_3-全局替换ssh请求为http请求" tabindex="-1">3. 全局替换ssh请求为http请求 <a class="header-anchor" href="#_3-全局替换ssh请求为http请求" aria-label="Permalink to &quot;3. 全局替换ssh请求为http请求&quot;">​</a></h2><p>这一步是为了解决不方便用ssh拉取时，选用http拉取</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --global</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> url.&quot;git@gitlab.xxx.cn&quot;.insteadOf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://gitlab.xxx.cn&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="_4-配置-netrc" tabindex="-1">4. 配置 .netrc <a class="header-anchor" href="#_4-配置-netrc" aria-label="Permalink to &quot;4. 配置 .netrc&quot;">​</a></h2><p>这一步可以直接省略第 2、3 两个步骤，直接使用 .netrc 文件（文件路径： ~/.netrc ），如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">machine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gitlab.xxx.cn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> login</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 用户名</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> password</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 上面设置的秘钥</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>使用该步骤还可以解决掉一个 <code>gitlab</code> 的一个不能拉取子组库的问题: <a href="https://gitlab.com/gitlab-org/gitlab-foss/-/issues/30785" target="_blank" rel="noreferrer">Go get fails with the usage of subgroups</a>，比如：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如下拉取命令如果不使用步骤4的话就会报错 </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 因为由于gitlab的限制，最多只能拉取到一个层级，即 gitlab.xxx.cn/a/b.git</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gitlab.xxx.cn/a/b/c.git</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div>`,13);function y(s,v,B,_,x,E){const t=p,l=g("ClientOnly");return e(),r("div",null,[m,o(l,null,{default:d(()=>{var a,i;return[(((a=s.$frontmatter)==null?void 0:a.aside)??!0)&&(((i=s.$frontmatter)==null?void 0:i.showArticleMetadata)??!0)?(e(),b(t,{key:0,article:s.$frontmatter},null,8,["article"])):u("",!0)]}),_:1}),C])}const O=h(F,[["render",y]]);export{D as __pageData,O as default};
